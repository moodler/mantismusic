# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Mantis Music is a static, self-hosted, Spotify-style artist discography web application. Music is managed as files and folders under `/music`, compiled to JSON by a Python build script, and served as a vanilla JS single-page app. A Flask admin UI provides browser-based metadata editing.

## Architecture

**Static Site:**
- `index.html` — Single-page app entry point
- `js/app.js` — All application logic (data loading, rendering, filtering, audio player, navigation)
- `css/style.css` — Complete styling with CSS custom properties for theming
- `data/discography.json` — Compiled music database (generated by build script)

**Build Pipeline:**
- `build_music_json.py` — Reads `/music` folder structure, compiles to `data/discography.json`. Also auto-links streaming URLs via Spotify, Apple Music, Tidal, and Deezer APIs.
- `config.json` — Spotify API credentials (gitignored). Tidal uses built-in credentials. Deezer/Apple Music are public APIs.

**Admin UI:**
- `admin.py` — Flask app serving at localhost:5001
- `templates/` — Jinja2 templates for dashboard, track editor, collection editor, artist editor

**Data Flow:**
1. Artist manages files under `/music` (tracks, collections, artist.md, images, audio, lyrics)
2. `build_music_json.py` compiles everything into `data/discography.json`
3. Frontend loads the JSON and renders the player
4. Audio files are served directly from `/music/tracks/`

**Key State Variables in app.js:**
- `discographyData` — Raw loaded JSON
- `allTracks` — Flattened track list (filtered by search/tags/year)
- `currentView` — Active navigation view ('tracks', 'collections', 'about')
- `navigationHistory` — Stack for back-button navigation between views
- `currentTrack`, `currentRelease` — Currently playing track and its parent release
- `queue` — Playback queue

## Music Folder Structure

```
music/
├── artist/
│   ├── artist.md           # YAML frontmatter: name, social links. Body: bio text
│   ├── profile.jpg         # Square profile image
│   └── banner.png          # Wide banner image
├── tracks/
│   └── song_name/
│       ├── track.md        # YAML frontmatter: title, duration, tags, credits, streaming URLs. Body: description
│       ├── song_name.mp3   # Audio file
│       ├── song_name.jpg   # Cover art (optional)
│       └── song_name.txt   # Lyrics plain text (optional)
└── collections/
    └── album_name/
        ├── collection.md   # YAML frontmatter: title, type, tracks list, streaming URLs. Body: description
        └── album_name.jpg  # Cover art (optional)
```

Collections reference tracks by folder slug. Tracks not in any collection appear as standalone singles.

## Development

```bash
python3 -m http.server 8000    # Serve the site
python3 build_music_json.py    # Rebuild JSON from /music
python3 admin.py               # Run admin UI on port 5001
```

Dependencies: `pyyaml`, `requests` (for build script), `flask` (for admin).
