{# Mantis Music - Copyright (C) 2026 Martin Dougiamas - GPL v3 #}
{% extends "admin_base.html" %}
{% block title %}Artist{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <div class="breadcrumb"><a href="/">Dashboard</a> / Artist</div>
        <h1>Artist Profile</h1>
    </div>
    <div class="flex gap-1">
        <button class="btn btn-primary" onclick="saveArtist()">Save</button>
    </div>
</div>

<div class="page-content">
    <div style="max-width: 640px;">
        <div class="form-group">
            <label>Profile Image</label>
            <div class="cover-zone" id="profile-zone"
                 style="width: 200px; height: 200px; border-radius: 50%; overflow: hidden;
                        {% if profile_url %}background-image: url('{{ profile_url }}?t={{ range(100000) | random }}'); background-size: cover; background-position: center;{% endif %}">
                {% if not profile_url %}<span class="cover-placeholder">Click, paste, or drag to upload profile image</span>{% endif %}
            </div>
            <input type="file" id="profile-file" accept="image/*" style="display:none">
        </div>

        <div class="form-group">
            <label>Banner Image</label>
            <div class="cover-zone" id="banner-zone"
                 style="width: 100%; height: 180px; border-radius: 8px; overflow: hidden;
                        {% if banner_url %}background-image: url('{{ banner_url }}?t={{ range(100000) | random }}'); background-size: cover; background-position: center;{% endif %}">
                {% if not banner_url %}<span class="cover-placeholder">Click, paste, or drag to upload banner image</span>{% endif %}
            </div>
            <input type="file" id="banner-file" accept="image/*" style="display:none">
        </div>

        <div class="form-group">
            <label>Name</label>
            <input type="text" class="form-input" id="field-name"
                   value="{{ frontmatter.get('name', '') }}">
        </div>

        <div class="form-group">
            <label>Bio</label>
            <textarea class="form-textarea" id="field-bio" rows="6">{{ bio }}</textarea>
        </div>

        <div class="section-header mt-3">
            <h2>Social Links</h2>
        </div>

        <div class="form-group">
            <label>Spotify</label>
            <input type="url" class="form-input" id="field-spotify"
                   value="{{ frontmatter.get('spotify', '') }}">
        </div>
        <div class="form-group">
            <label>Apple Music</label>
            <input type="url" class="form-input" id="field-apple_music"
                   value="{{ frontmatter.get('apple_music', '') }}">
        </div>
        <div class="form-group">
            <label>YouTube</label>
            <input type="url" class="form-input" id="field-youtube"
                   value="{{ frontmatter.get('youtube', '') }}">
        </div>
        <div class="form-group">
            <label>Website</label>
            <input type="url" class="form-input" id="field-website"
                   value="{{ frontmatter.get('website', '') }}">
        </div>
        <div class="form-group">
            <label>Tidal</label>
            <input type="url" class="form-input" id="field-tidal"
                   value="{{ frontmatter.get('tidal', '') }}">
        </div>
        <div class="form-group">
            <label>Deezer</label>
            <input type="url" class="form-input" id="field-deezer"
                   value="{{ frontmatter.get('deezer', '') }}">
        </div>
        <div class="form-group">
            <label>SoundCloud</label>
            <input type="url" class="form-input" id="field-soundcloud"
                   value="{{ frontmatter.get('soundcloud', '') }}">
        </div>
        <div class="form-group">
            <label>Instagram</label>
            <input type="url" class="form-input" id="field-instagram"
                   value="{{ frontmatter.get('instagram', '') }}">
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        initCoverZone('profile-zone', 'profile-file', '/api/artist/profile');
        initCoverZone('banner-zone', 'banner-file', '/api/artist/banner');
    });

    async function saveArtist() {
        const data = {
            name: document.getElementById('field-name').value,
            bio: document.getElementById('field-bio').value,
            spotify: document.getElementById('field-spotify').value,
            apple_music: document.getElementById('field-apple_music').value,
            youtube: document.getElementById('field-youtube').value,
            website: document.getElementById('field-website').value,
            tidal: document.getElementById('field-tidal').value,
            deezer: document.getElementById('field-deezer').value,
            soundcloud: document.getElementById('field-soundcloud').value,
            instagram: document.getElementById('field-instagram').value,
        };

        try {
            const resp = await fetch('/api/artist/save', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });
            const result = await resp.json();
            showToast(result.ok ? 'Artist saved' : (result.error || 'Failed'), result.ok ? 'success' : 'error');
        } catch (e) {
            showToast('Error: ' + e.message, 'error');
        }
    }
</script>
{% endblock %}
